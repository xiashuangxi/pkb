---
layout: post
title: ä½¿ç”¨dervieğŸš§ğŸŒˆ
category: [serde]
tag: [serde]
permalink: /Title::title
toc: true
---
serdeæä¾›äº†ä¸€ä¸ªderiveå®ï¼Œç”¨äºä¸ºæ‚¨çš„crateä¸­å®šä¹‰çš„æ•°æ®ç»“æ„ç”Ÿæˆ`Serialize`å’Œ`Deserialize`
traitçš„å®ç°ï¼Œä»è€Œå¯ä»¥æ–¹ä¾¿åœ°ä»¥æ‰€æœ‰serdeçš„æ•°æ®æ ¼å¼è¡¨ç¤ºå®ƒä»¬ã€‚

# ä»…å½“æ‚¨çš„ä»£ç ä½¿ç”¨æ—¶æ‰éœ€è¦è¿›è¡Œè®¾ç½® #[derive(Serialize, Deserialize)]
è¯¥åŠŸèƒ½æ˜¯åŸºäºRustçš„`#[derive]`æœºåˆ¶ï¼Œå°±åƒä½ ä¼šä½¿ç”¨å†…ç½®çš„è‡ªåŠ¨æ´¾ç”Ÿå®ç°ä»€ä¹ˆ`Clone`,`Copy`
,`Debug`æˆ–å…¶ä»–traitã€‚å®ƒèƒ½å¤Ÿä¸ºå¤§å¤šæ•°æ®ç»“æ„å’Œæšä¸¾ç”Ÿæˆå®ç°ï¼ŒåŒ…æ‹¬å…·æœ‰å¤æ‚çš„æ³›å‹ç±»å‹æˆ–
traitèŒƒå›´çš„ç»“æ„å’Œæšä¸¾ã€‚åœ¨æå°‘æƒ…å†µä¸‹ï¼Œå¯¹äºç‰¹åˆ«å¤æ‚çš„ç±»å‹ï¼Œæ‚¨å¯èƒ½éœ€è¦æ‰‹åŠ¨å®ç°traitã€‚

è¿™äº›æ´¾ç”Ÿè¦æ±‚ä½¿ç”¨Rustç¼–è¯‘å™¨1.31å¯æ›´é«˜çš„ç‰ˆæœ¬ã€‚
- åœ¨Cargo.tomlä¸­æ·»åŠ `serde = { version = "1.0", features = ["derive"] }`ä¸ºä¾èµ–é¡¹ã€‚
- ç¡®ä¿æ‰€æœ‰å…¶ä»–åŸºäºserdeçš„ä¾èµ–å…³ç³»ï¼ˆä¾‹å¦‚serde_jsonï¼‰éƒ½åœ¨ä¸serde 1.0 å…¼å®¹çš„ç‰ˆæœ¬ä¸Šã€‚
- åœ¨è¦åºåˆ—åŒ–çš„ç»“æ„å’Œæšä¸¾ä¸Šï¼Œå°†å¯¼å‡ºä½œä¸º`use serde::Serialize;`åŒä¸€æ¨¡å—å¯¼å…¥ï¼Œå¹¶å°†
`#[derive(Serialize)]`åœ¨ç»“æ„å¯æšä¸¾ä¸Šå†™ä¸Š
- åŒæ ·ï¼Œå¯¼å…¥`use serde::Deserialize;` å¹¶å°†`#[derive(Deserialize)]`ä¸Šè¦ååºåˆ—åŒ–çš„ç»“æ„
å’Œæšä¸¾ä¸Šå†™ä¸Šã€‚

è¿™æ˜¯Cargo.toml:
``` toml
[package]
name = "xxxxx"
version = "0.1.0"
authors = ["xxxxxxx"]

[dependencies]
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
```

ç°åœ¨åœ¨`src/main.rs`ä¸­ä½¿ç”¨serdeè‡ªå®šä¹‰çš„å¯¼å‡ºï¼š
``` rust
use serde::{Serialize, Deserialize};

#[derive(Serialize, Deserialize, Debug)]
struct Point {
    x: i32,
    y: i32,
}

fn main() {
    let point = Point{ x: 1, y: 2 };

    let serialized = serde_json::to_string(&point).unwrap();
    println!("serialized = {}", serialized);

    let deserialized: Point = serde_json::from_str(&serialized).unwrap();
    println!("deserialized = {:?}", deserialized);
}
```

è¾“å‡ºï¼š
```
$ cargo run
serialized = {"x":1,"y":2}
deserialized = Point { x: 1, y: 2 }
```

# æ•…éšœæ’é™¤
æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°ç¼–è¯‘æ—¶é”™è¯¯ï¼Œè¿™äº›é”™è¯¯å‘Šè¯‰æ‚¨ï¼š
```
the trait `serde::ser::Serialize` is not implemented for `...`
```

å³ä½¿structæˆ–enumæ˜¾ç„¶åŒ…å«`#[derive(Serialize)]`åœ¨ä¸Šé¢ã€‚

è¿™å‡ ä¹æ€»æ˜¯æ„å‘³ç€æ‚¨ä½¿ç”¨çš„åº“ä¾èµ–äºserdeçš„ä¸å…¼å®¹ç‰ˆæœ¬ã€‚æ‚¨å¯èƒ½ä¾èµ–Cargo.tomlä¸­çš„serde 1.0ï¼Œ
ä½†ä½¿ç”¨çš„æ˜¯ä¾èµ–serde 0.9çš„å…¶ä»–åº“ã€‚å› æ­¤ï¼Œ`Serialize`å¯ä»¥å®ç°serde 1.0çš„traitï¼Œä½†æ˜¯åº“
å¸Œæœ›å®ç°`Serialize`serde 0.9çš„traitã€‚ä»Rustç¼–è¯‘å™¨çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›æ˜¯å®Œå…¨ä¸åŒçš„traitã€‚

è§£å†³æ–¹æ³•æ˜¯æ ¹æ®éœ€è¦å‡çº§æˆ–é™çº§åº“ï¼Œç›´åˆ°serdeç‰ˆæœ¬åŒ¹é…ä¸ºæ­¤ã€‚è¯¥`cargo tree -d`å‘½ä»¤å¯¹äºæŸ¥æ‰¾
æ‰€æœ‰å¼•å…¥é‡å¤ä¾èµ–é¡¹çš„ä½ç½®å¾ˆæœ‰å¸®åŠ©ã€‚

# é˜…è¯»æ–‡çŒ®
[https://serde.rs/derive.html](https://serde.rs/derive.html)