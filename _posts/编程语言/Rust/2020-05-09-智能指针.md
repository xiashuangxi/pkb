---
layout: post
title: 智能指针🚧🌈
category: [Rust]
tag: [rust]
permalink: /Title::title
toc: true
---
# 指针概念
指针是一包含内存地址的变量通用概念，这个内存地址引用或指向一些数据。

## 指针类型
- **引用指针：**
    引用指针是以`&`符号为标示并借用他们所指向的值。除了引用数据没有任何其他功能。同时他们也没有额外的开销。因此在实际应用中比较多。
- **智能指针：**
    智能指针是一种数据结构，他们的表示类似指针，他同时也拥有额外的数据和功能。
    智能指针通常使用数据结构进行实现。智能指针与常规的结构体的区别在于实现了`Deref`和`Drop`trait。
    1.  ***Derer：***允许智能指针结构体实体个表现的像引用一样，这样就可以编写即可用于引用，又可用于智能指针的代码。
    2.  ***Drop：***允许我们自定义的智能指针离开作用域时运行的代码。

*引用指针与智能指针的区别：引用指针只是借用数据的指针。而在大部分的情况下，智能指针拥有他们所指向的数据。*

# 智能指针
## Box
Box是一种最简单直接的智能指针类型。**它允许你将一个值存放在堆上而不是栈上，存储在栈上的的数据是指向堆数据**的指针。
Box只是将数据存储在堆上不是栈上，也没有其它额外的功能所以也没有什么性能损失。

### 使用Box在堆上存储数据
``` rust
let a = Box::new(1);
println!("{}", a);
```
这里定义了一个变量`a`，它的值是指向一个被分配在堆上值为`1`的`Box`。上面的示例中最终打印的结果是`1`。

在这个示例中，我们可以像数据是存储在栈上的那样来访问`Box`中的数据。和其它拥有数据所有权的值一样，当`a`在离开作用域时，它将会被释放（释放`Box`本身（位栈上）和所指向的数据（位于堆上））。

### 适用场景
- 当存在一个在编译时未知大小的类型，而又想要在需要确定大小的上下文中使用这个类型值的时候。
- 当有大量数据并希望在确保数据不被拷贝的情况下转移所有权的时候。
- 希望拥有一个值并只关心它的类型是否实现了特定的trait而不是其具体类型。

## Rc引用计数器
`Rc<T>`引用计数（*reference counting*）的缩写。引用计数顾名思义就是记录一个值引用的数量来判断这个值是否仍然被使用。如果这个值的引用数为零，则表示没有什么有效引用并可以被清理。

> **注意：**`Rc<T>`只能用于单线程的场景。如果需要在多线程中使用请使用`Arc<T>`

## Arc

## RefCell
内部可变性

## Mutex